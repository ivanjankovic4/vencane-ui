---
// Fajl: src/pages/gallery.astro
import BaseLayout from '../layouts/BaseLayout.astro';
import { Image } from 'astro:assets';

const sveSlike = await import.meta.glob<{ default: ImageMetadata }>(
  '/src/assets/gallery/**/*.{jpeg,jpg,png,gif,webp}'
);
---

<BaseLayout>
  <main class="gallery-container">
    <h1>Galerija Sela</h1>
    <p>Pogledajte lepote na≈°eg kraja.</p>

    <div class="image-grid" id="gallery">
      {
        Object.values(sveSlike).map(async (slikaPromise) => {
          const slika = (await slikaPromise()).default;
          return (
            <a 
              href={slika.src} 
              class="grid-item" 
              data-pswp-width={slika.width}
              data-pswp-height={slika.height}
              target="_blank" 
              rel="noreferrer"
            >
              <Image src={slika} alt="Slika iz galerije" loading="lazy" />
            </a>
          );
        })
      }
    </div>
  </main>
</BaseLayout>

<script>
  import PhotoSwipeLightbox from 'https://unpkg.com/photoswipe@5/dist/photoswipe-lightbox.esm.js';

  const lightbox = new PhotoSwipeLightbox({
    gallery: '#gallery',
    children: 'a',
    pswpModule: () => import('https://unpkg.com/photoswipe@5/dist/photoswipe.esm.js')
  });

  lightbox.init();
</script>

<style>

  .gallery-container {
    padding: 40px 20px;
    max-width: 1200px;
    margin: 0 auto;
    text-align: center;
  }
  .image-grid {
    display: grid;
    grid-template-columns: repeat(auto-fill, minmax(300px, 1fr));
    gap: 16px;
    margin-top: 40px;
  }
  .grid-item {
    display: block;
    width: 100%;
    overflow: hidden;
    border-radius: 8px;
    box-shadow: 0 4px 8px rgba(0, 0, 0, 0.2);
    aspect-ratio: 1 / 1;
  }
  .grid-item img {
    display: block;
    width: 100%;
    height: 100%;
    object-fit: cover;
    transition: transform 0.3s ease;
  }
  .grid-item:hover img {
    transform: scale(1.05);
  }
  body {
    overflow-y: auto !important;
    height: auto !important;
  }
</style>